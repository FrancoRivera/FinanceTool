<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="&nbsp;" />
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="mstile-310x310.png" />
    <title>The tool</title>
    <!-- Bootstrap core CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" media="all" href="../assets/css/jquery-ui.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/main.css">
</head>

<body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <a class="navbar-brand" href="#">Exam Tool</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active"><a  class="nav-link" href="/index.html">Home <span class="sr-only">(current)</span></a></li>
                    <li class="nav-item"><a class="nav-link" href="/tema2.html">Dinero en el Tiempo y Tasas</a></li>
                    <li class="nav-item"><a  class="nav-link" href="/tema3.html">Ecuacion equiv Valor</a></li>
                    <li class="nav-item"><a  class="nav-link" href="/tema4.html">Instrum Financ.</a></li>
                    <li class="nav-item"><a  class="nav-link" href="/tema5.html">Planes de Pago</a></li>
        </ul>
      </div>
    </nav>
    <div class="margin_50"></div>
    <div class="container">
        <h2 id="tema4">Indicadores de Rentabilidad</h2>
        <div class="row">
            <div class="col-md"><label for=""><b>Num de Proyectos</b></label>
                <select id="cant_proyectos" class="form-control" onchange="createTableProyectos()">
                <option value="1">1</option>
                <option value="2" selected>2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select>
            </div>
            <div class="col-md">
                <label><b>Num de Años</b></label>
                      <select id="cant_periodos" class="form-control" onchange="createTableProyectos()">
                <option value="1">1</option>
                <option value="2" selected>2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>

            </div>
            <div class="col-md">
                    <label for=""><b>TEA % (COK)</b></label>
                    <input type="number" placeholder="TEA" value="7"  class="form-control" id="TEA_proyectos">
            </div>
        </div>
        <div class="margin_50"></div>
        <div class="row">
            <div class="col-md">
            <table class="table table-hover table-striped">
                <thead id="thead_proyectos"></thead>
                <tbody id="tbody_proyectos"></tbody>
            </table>
        </div>
    </div>
        <div class="row">
            <div class="col-md">  <button onclick="calcularIndicadores()" class="btn btn-success form-control">Calcular VAN, TIR, PRD, BC</button></div>
            <div class="col-md"><button onclick="calcularCostos()" class="btn btn-primary form-control">Calcular VAC, CAUE, MCM</button></div>
        </div>
            
            </div>

            
     
        </div>
        <div class="row">
            <div class="col-md" id="numeros_proyectos">
                      </div>
        </div>
        <div class="margin_100"></div>
    </div> <!--end of container -->
            

    <!-- /.container -->
    <div class="side_bar">
        <a href="#">
            <div class="toggle_sidebar">Hide</div>
        </a>
    </div>
    <script src="../assets/js/jquery.min.js"></script>
    <script src="../assets/js/jquery-ui.min.js"></script>   
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.0/Chart.min.js"></script>
    <script src='../assets/js/MathJax.js?config=TeX-MML-AM_CHTML'></script>
    <script src="../assets/js/main.js"></script>
   
    <script>
    function calcularTIR(id){
        var cant_periodos = parseInt($("#cant_periodos").val())+1
         min = 0.0;
        max = 1.0;
      do {
        guess = (min + max) / 2;
        NPV = 0;
        for (var j=0; j<cant_periodos; j++) {
              NPV += getValor(id,j);
        }
        if (NPV > 0) {
          min = guess;
        }
        else {
          max = guess;
        }
      } while(Math.abs(NPV) > 0.000001);
      return guess * 100;
    }
    function getValor(proyecto, periodo){
        return eval($("#p_"+proyecto+"_per_"+periodo).val() != ""?($("#p_"+proyecto+"_per_"+periodo).val()):0)
    }
    function calcularVAN(id){
        var cant_periodos = parseInt($("#cant_periodos").val())+1
        var TEA = parseInt($("#TEA_proyectos").val())/100
        var NPV = 0
        for (var j=1; j<cant_periodos; j++) {
              NPV += getValor(id,j)/Math.pow((1+TEA),j);
        }
        return NPV - getValor(id,0)
    }
    function calcularPRD(id){
        var cant_periodos = parseInt($("#cant_periodos").val())+1
        var TEA = parseInt($("#TEA_proyectos").val())/100
        var NPV = 0
        for (var j=0; j<cant_periodos; j++) {
             var last = NPV //guardov alor anterior
              NPV += getValor(id,j);
              if (NPV > 0 &&  last < 0){ //cuando cambia de signo
                var PRD = Math.abs(NPV)+Math.abs(last) 
                PRD =  Math.abs(last) / PRD
                return j+PRD-1; //mes anterior
              }
        }
        return 0
    }
    function calcularBC(id){
         var cant_periodos = parseInt($("#cant_periodos").val())+1
        var TEA = parseInt($("#TEA_proyectos").val())/100
        var NPV = 0 
        for (var j=1; j<cant_periodos; j++) {
              NPV += getValor(id,j);

        }
        return NPV/(-eval($("#p_"+id+"_per_"+0).val()))
    }
    function findMCM(num1, num2){
            num = (num1>=num2)?num1:num2;
            den = (num1<=num2)?num1:num2;
            rem=num%den
            console.log(rem)
            while(rem==0){
                num=den
                den=rem
                rem=num%den
                console.log("XD")
            }
            gcd=den
            lcm=int(int(num1*num2)/int(gcd))
            return lcm
    }
    function calcularMCM(id){
        var cant_proyectos = $("#cant_proyectos").val()
        var cant_periodos = parseInt($("#cant_periodos").val())+1
        var TEA = parseInt($("#TEA_proyectos").val())/100
        var anios_maquinas = []
        for (var i = 1; i <= cant_proyectos;i++){
            var max = 0;
                for (var j=1; j<cant_periodos; j++) {
                    if (getValor(i,j) != 0){
                        max = j
                    }
                }
                anios_maquinas.push(max)
        }
        num1=anios_maquinas[0]
        num2=anios_maquinas[1]
        lcm=findMCM(num1,num2)
         
        for (var i= 2; i < anios_maquinas.length; i++){
            lcm=findMCM(lcm,l[i])
        }
        console.log(lcm)
        return 0
    }
        function calcularCAUE(id){
       return 0
    }



    function calcularIndicadores(){
        var cant_proyectos = $("#cant_proyectos").val()
        var cant_periodos = parseInt($("#cant_periodos").val())+1
        $("#numeros_proyectos").html("")
         var new_table = $('<table></table>').attr({ id: "basicTable",class:"table table-hover"}).appendTo("#numeros_proyectos");
          
         var thead  = $("<tr></tr>").appendTo(new_table)
        
        for (var i = 0; i <= cant_proyectos; i++) {
            if (i == 0){
                    $("<th></th>").html("Metodo").appendTo(thead)
                }
                else{
                     $("<th></th>").html($("#proyecto_"+i).val()).appendTo(thead)
                }      
        }
        var TIR = $("<tr></tr>").appendTo(new_table).append($("<th>TIR</th>"))
        var VAN = $("<tr></tr>").appendTo(new_table).append($("<th>VAN/VAC</th>"))
        var PRD = $("<tr></tr>").appendTo(new_table).append($("<th>PRD</th>"))
        var BC = $("<tr></tr>").appendTo(new_table).append($("<th>BC</th>"))
        var MCM = $("<tr></tr>").appendTo(new_table).append($("<th>MCM</th>"))
        var CAUE = $("<tr></tr>").appendTo(new_table).append($("<th>CAUE</th>"))
        for (var i = 1; i <= cant_proyectos; i++) {
            $("<td></td>").text(calcularTIR(i)).appendTo(TIR);
            $("<td></td>").text(calcularVAN(i)).appendTo(VAN);
            $("<td></td>").text(calcularPRD(i)).appendTo(PRD);
            $("<td></td>").text(calcularBC(i)).appendTo(BC);
            $("<td></td>").text(calcularMCM(i)).appendTo(MCM);
            $("<td></td>").text(calcularCAUE(i)).appendTo(CAUE);
        }
    }

    function calcularCostos(){
        var cant_proyectos = $("#cant_proyectos").val()
        var cant_periodos = parseInt($("#cant_periodos").val())+1
        $("#numeros_proyectos").html("")
        
        var new_table = $('<table></table>').attr({ id: "basicTable",class:"table table-hover"}).appendTo("#numeros_proyectos");
          
         var thead  = $("<tr></tr>").appendTo(new_table)
        
        for (var i = 0; i <= cant_proyectos; i++) {
            if (i == 0){
                    $("<th></th>").html("Metodo").appendTo(thead)
                }
                else{
                     $("<th></th>").html($("#proyecto_"+i).val()).appendTo(thead)
                }      
        }
        var VAN = $("<tr></tr>").appendTo(new_table).append($("<th>VAC</th>"))
        var MCM = $("<tr></tr>").appendTo(new_table).append($("<th>MCM</th>"))
        var CAUE = $("<tr></tr>").appendTo(new_table).append($("<th>CAUE</th>"))
        for (var i = 1; i <= cant_proyectos; i++) {
            $("<td></td>").text(calcularVAN(i)).appendTo(VAN);
            $("<td></td>").text(calcularMCM(i)).appendTo(MCM);
            $("<td></td>").text(calcularCAUE(i)).appendTo(CAUE);
        }
    }

    function createTableProyectos(){
        var cant_proyectos = $("#cant_proyectos").val()
        var cant_periodos = parseInt($("#cant_periodos").val())+1
        $("#tbody_proyectos").html("")
        $("#thead_proyectos").html("")

        var thead  = $("<tr></tr>").appendTo($("#thead_proyectos"))
        for (var i = 0; i <= cant_proyectos; i++) {
            if (i == 0){
                    $("<th></th>").html("Año").appendTo(thead)
                }
                else{
                     $("<th></th>").html("<input type='text' class='form-control' id='proyecto_"+i+"' placeholder='Nombre del proyecto " +i + "'>").appendTo(thead)
                }
            
        }
       
        for (var i = 0; i < cant_periodos; i++) {
             var row =  $("<tr></tr>").appendTo($("#tbody_proyectos"))
            for (var j = 0; j <= cant_proyectos; j++) {
                if (j == 0){
                    $("<th></th>").html(i).appendTo(row)
                }
                else{
                    $("<td></td>").html("<input type='text' class='form-control'  id='p_"+j+"_per_"+i+"' placeholder='Periodo "+i+"'>").appendTo(row)
                }
                
            }
        }
    }

    $(function() {
    createTableProyectos()
        });
    </script>


</body>

</html>